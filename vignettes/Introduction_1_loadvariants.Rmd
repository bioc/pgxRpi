---
title: "Introduction_1_loadvariants"
author: "Hangjia Zhao"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{introduction_I_loadvariants}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Load library 

```{r setup}
library(pgxRpi)
```

## `pgxLoader` function in this package

This function loads various data from `Progenetix` database.  

The parameters of this function:

* `type` A string specifying output data type. Available options are "biosample", 
"variant" or "frequency". 
* `output` A string specifying output file format. Available options are NULL, 
'pgxseg' or 'seg' when the parameter `type` is "variant"; 'pgxseg' or 'pgxmatrix' 
when the parameter `type` is "frequency".
* `filters` A single or a comma-concatenated list of identifiers for cancer type,
literature, and cohorts such as c("NCIT:C7376","icdom-98353","PMID:22824167", "pgxcohort-TCGAcancers").
Only used if the parameter `type` is "biosample" or "frequency".
* `codematches` A logical value determining whether to exclude samples 
from child terms of specified filters. If FALSE, retrieved samples include child 
terms of specified filters. Only used when `filters` is specified. Default is FALSE.
* `biosample_id` A single or a comma-concatenated list of identifiers used in Progenetix 
database for identifying biosamples. 
* `save_file` A logical value determining whether to save the variant data as file 
instead of direct return. Only used when the parameter `type` is "variant". Default is FALSE.
* `filename` A string specifying the path and name of the file to be saved. 
Only used if the parameter `save_file` is TRUE. Default is "variants.seg/pgxseg" in current work directory.

# Retrieve biosamples from specific groups of interests

Relevant parameters of `pgxLoader` function: type, filters, codematches, biosample_id

```{r}
biosamples <- pgxLoader(type="biosample", filters = "NCIT:C3059")
```

The data contains many columns representing different aspects of biosample information

```{r}
head(biosamples)
```

The NCIt code of retrieved biosamples doesn't only contain specified filters but contains child terms. 

```{r}
unique(biosamples$histological_diagnosis_id)
```

Setting `codematches` as TRUE allows this function to only return biosamples with exact match to the filter.

```{r}
biosamples <- pgxLoader(type="biosample", filters = "NCIT:C3059",codematches = TRUE)
unique(biosamples$histological_diagnosis_id)
```

You can also retrieve biosamples by biosample id used in Progenetix database

```{r}
biosamples <- pgxLoader(type="biosample", filters = "NCIT:C3059",codematches = TRUE,
                        biosample_id = c("pgxbs-kftva5zv","pgxbs-kftva5zw"))
```
The result only contains samples with the specified filter NCIT:C3059 and the specified biosample id 

```{r}
biosamples[biosamples$histological_diagnosis_id != "NCIT:C3059",'biosample_id']
```

# Retrieve variants by  biosampleid

Relevant parameters of `pgxLoader` function: type, output, biosample_id, save_file, filename

## Get biosamples id from previously retrieved biosample information

```{r}
biosample_id <- biosamples$biosample_id[c(1:20)]
```

There are three output formats. 

## The first output format (by default)

 This format contains variant id and associated biosample id as well as analysis id. The variant is represented as 'DUP' (duplication) or 'DEL' (deletion) in specific chromosome locations. A few variants are point mutations represented by columns `reference_bases` and `alternate_bases`.

```{r}
variant_1 <- pgxLoader(type="variant", biosample_id = biosample_id)
head(variant_1)
```

## The second output format (`output` = "pgxseg")

This format is '.pgxseg' file format. It contains segment mean values (in `log2` column), which are equal to log2(copy number of measured sample/copy number of control sample (usually 2)). 

```{r}
variant_2 <- pgxLoader(type="variant", biosample_id = biosample_id,output = "pgxseg")
head(variant_2)
```

## The third output format (`output` = "seg")

This format is similar to the general '.seg' file format and compatible with IGV tool for visualization. The only difference between this file format and the general '.seg' file format is the fifth column. It represents variant type in this format while in the general '.seg' file format, it represents number of probes or bins covered by the segment. In addition, the point mutation variants are excluded in this file format.

```{r}
variant_3 <- pgxLoader(type="variant", biosample_id = biosample_id,output = "seg")
head(variant_3)
```

# Export variants data for visualization

Setting `save_file` as TRUE in `pgxLoader` function would make this function doesn't return 
variants data directly but let the retrieved data saved in the current work directory by default or other 
paths (specified by `filename`). The export is only available for variants data (type='variant'). 

## Upload 'pgxseg' file to Progenetix website

The following command creates a '.pgxseg' file with the name "variants.pgxseg" in "~/Downloads/" folder. 

```{r}
pgxLoader(type='variant', output='pgxseg', biosample_id=biosample_id, save_file=TRUE, 
          filename="~/Downloads/variants.pgxseg")
```

You can upload this '.pgxseg' file to [this link](https://progenetix.org/service-collection/uploader) 
for visualization.

## Upload '.seg' file to IGV

The following command creates a special '.seg' file with the name "variants.seg" in "~/Downloads/" folder. 

```{r}
pgxLoader(type='variant', output='seg', biosample_id=biosample_id, save_file=TRUE, 
          filename="~/Downloads/variants.seg")
```

You can upload this '.seg' file to [IGV tool](https://software.broadinstitute.org/software/igv/) for visualization.

# Session Info

```{r echo = FALSE}
sessionInfo()
```
